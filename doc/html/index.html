<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Starship Code Contest: Starship Code Contest Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Starship Code Contest
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A real student nightmare...</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Starship Code Contest Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro">Introduction</a></li>
<li class="level1"><a href="#process">How the game processes</a><ul><li class="level2"><a href="#Launch">Launching the game</a></li>
<li class="level2"><a href="#selection">The selection of plugins</a></li>
<li class="level2"><a href="#Fight">Fighting time!</a></li>
</ul>
</li>
<li class="level1"><a href="#api">Application Programming Interface</a><ul><li class="level2"><a href="#acquisition">The acquisition module</a></li>
<li class="level2"><a href="#symbols">The required symbols</a></li>
<li class="level2"><a href="#plugin">Writing its own plugin</a></li>
<li class="level2"><a href="#radar">Use of the radar</a></li>
</ul>
</li>
<li class="level1"><a href="#game">Game details and rules</a></li>
<li class="level1"><a href="#action">It is time to action</a></li>
<li class="level1"><a href="#bugs">Known bugs and improvements suggestions</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>The Starship Code Contest is a graphical arena bot game written in C. The game exploits fully the graphical library libMLV written by Adrien Boussicault and Marc Zipstein. The game present an Application Programming Interface for allowing any programmer to add its own bot which will can figth inside the game. Each starship in the game is piloted by a plugin (a dynamic libray as a linux shared object) which is automatically dynamically loaded during the launch of the programm. The game can be described as a real time strategy game as the graphical interface display 32 frames per seconds and actions can be resolve at each frame.</p>
<p>As the bot have to able to play alone or inside a team, the motto of the game is : "Search and destroy yes... But destroy the right
one"</p>
<h1><a class="anchor" id="process"></a>
How the game processes</h1>
<p>They are three important step during the execution of an instance of the game. Chronoligycally, the game initializes the plugins found, proposes the user the constitution of teams and finishes by displaying the resulted fight on the screen.</p>
<h2><a class="anchor" id="Launch"></a>
Launching the game</h2>
<p>The game can be started using the command <code>./starshipcode</code> in a terminal located in the proper directory. The program first initializes a lot of objects for the graphic interface (images loading, explosions loading...) and scans the shared object living in the directory <code>plugins</code>. The filter applied on the on the scandir (man section 3) function just select file whose name end by the three characters <code>.so</code>. It is thus advised to not copy file in this directory with a such name not being a dynamic library. We recall that valid C dynamic library must be compiled in two step : a first compilation to generate an object file containing non linked and position independent code (options -c and -fPIC), a second line of compilation with the option -shared to wrap the object file in a Linux shared object file. All shared objects are scanned by utilities provided by &lt;dlfcn.h&gt; in order to find three symbols (function pointers) setting the behavior of a starship.</p>
<p>The terminal may present some verbose during the loading of plugins as follow :</p>
<div class="fragment"><div class="line">nborie@perceval:~/Enseignement/projets_informatique/langage_C/starshipcode/ &gt; ./starshipcode </div><div class="line">STARSHIP CODE CONTEST</div><div class="line">Auto-loading of plugins...</div><div class="line">5 potential plugins founds : </div><div class="line">- circle_rand_shot.so... loading OK</div><div class="line">- full_dummy.so... loading OK</div><div class="line">- rand_all.so... loading OK</div><div class="line">- rand_move.so... loading OK</div><div class="line">- rand_shot.so... loading OK</div></div><!-- fragment --><p>TODO : CHANGE THAT FOR A BETTER INTRODUCTION SCREEN. I HATE DRAWING !!!!</p>
<div class="image">
<img src="intro.png" alt="intro.png" width="10cm"/>
<div class="caption">
Starting screen</div></div>
<p>The program propose a starting screen to introduce the game. After hitting a key or a mouse button, the selection screen pops.</p>
<h2><a class="anchor" id="selection"></a>
The selection of plugins</h2>
<p>Before seeing the game in action, the user must now constitute at least two teams before starting the fight. Among all scanned shared objects, the user can select available and well loaded plugin. Each plugin can have a single corresponding starship during a fight. This restrictive law is required since initialization and clean functions of plugins take no arguments and return void. In this sense, the use of static variables in plugins are strongly encouraged but prevent from multiple usages of a same A.I. during a fight.</p>
<p>The following screen shot display the selection screen.</p>
<div class="image">
<img src="selection_screen.png" alt="selection_screen.png" width="10cm"/>
<div class="caption">
Selection screen</div></div>
<p>Plugins are listed on the left. The user can select up to 12 plugins and forms up to 12 teams with the selected plugins. One there exist at least two different teams, the user can star the game (otherwise, a click on the start button should have no effect). That is now fighting time...</p>
<h2><a class="anchor" id="Fight"></a>
Fighting time!</h2>
<p>The game space is a square of size 800 pixels. The screen is split in two part : on the left the game space and contextual menu on the right.</p>
<div class="image">
<img src="fight_screen.png" alt="fight_screen.png" width="10cm"/>
<div class="caption">
Fight screen 1</div></div>
<p>A point of the space is internally describe with double floating number coordinates. Abscissa and ordinate can go from 0.0 to 10.0 but these bound are not absolutes since some side effects can happen during collision resolution. The collisions between a starship and a border follow the law of reflections. The incidence angle is thus equal to the reflection angle. The collision between two starships follow a law looking like the elastic choc of particles with no mass. That means the dispersion angle can be obtains with the arctangent of the slope between the two center of the concerned starships. Using the library &lt;math.h&gt; to program a smart plugin is not an option, it is a real necessity.</p>
<div class="image">
<img src="fight_screen_2.png" alt="fight_screen_2.png" width="10cm"/>
<div class="caption">
Fight screen 2</div></div>
<p>The right menu display the remaining life of alive starships in green and the damaged part in red. Dead starships are listed by plugin name on the right of the menu. At the very bottom of the menu, it is displayed the frame number (from 0 to 31) and each second, a percent describing the charge of computation. As this percent of busyness is lower than 100, the program handle the 32 frames per second. If a bad plugin make the program busy, this charge information help the user to identify poor A.I. Each frame, all plugin are consulted for decision making before the end frame resolution which resolve moves, collisions, explosions, gun status, radar status and shots. The graphical part of the program is the heavy part of computation (MLV_actualise_window in particular). The calculus part remained most of the time negligible behind graphic parts so a plugin can compute a lot of things each frame.</p>
<h1><a class="anchor" id="api"></a>
Application Programming Interface</h1>
<p>Here is now time to learn how to program your own starship.</p>
<h2><a class="anchor" id="acquisition"></a>
The acquisition module</h2>
<p>Any starship must collect information for smart decision making. These information can be get with two manner : the part concerning your own status (A starship know its team, its gear, where its radar is looking to...) and the part concerning the rest of the space which can be get by using your radar. Radar and gun turn faster than body of starship and a smart plugin could be able to remember parts of space it has scan before (static memory in shared object one more time).</p>
<p>Here is the source code of the header of the acquisition module :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef _ACQUISITION_</span></div><div class="line"><span class="preprocessor">#define _ACQUISITION_</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>{</div><div class="line">  <span class="keywordtype">int</span> move;</div><div class="line">  <span class="keywordtype">double</span> angle_starship;</div><div class="line">  <span class="keywordtype">double</span> angle_gun;</div><div class="line">  <span class="keywordtype">double</span> angle_radar;</div><div class="line">  <span class="keywordtype">int</span> shot;</div><div class="line">}<a class="code" href="structDecision__frame.html">Decision_frame</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>{</div><div class="line">  <span class="keywordtype">double</span> x;</div><div class="line">  <span class="keywordtype">double</span> y;</div><div class="line">  <span class="keywordtype">double</span> angle_move;</div><div class="line">  <span class="keywordtype">int</span> speed;</div><div class="line">  <span class="keywordtype">int</span> nb_team;</div><div class="line">}<a class="code" href="structView__starship.html">View_starship</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>{</div><div class="line">  <span class="keywordtype">double</span> x;</div><div class="line">  <span class="keywordtype">double</span> y;</div><div class="line">  <span class="keywordtype">double</span> angle_move;</div><div class="line">}<a class="code" href="structView__missile.html">View_missile</a>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="structAI.html">AI</a>)(<a class="code" href="structDecision__frame.html">Decision_frame</a>* f);</div><div class="line"></div><div class="line"><span class="keywordtype">double</span> <a class="code" href="acquisition_8h.html#abbeda0c5c19680f0c2303b88654931d4">get_x</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">double</span> <a class="code" href="acquisition_8h.html#abaed8968fcd2afe33793fbd1d39dd635">get_y</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">int</span> <a class="code" href="acquisition_8h.html#a0bc1a0f3fa84f7f4daa365a4532ae417">get_life</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">int</span> <a class="code" href="acquisition_8h.html#a9ca58372e384a567c735406f392904ae">get_speed</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">int</span> <a class="code" href="acquisition_8h.html#ae030fd4a1ace57f4e5355190805eb824">get_nb_team</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">int</span> <a class="code" href="acquisition_8h.html#acb0d4241dcd20ec4aa75607999c54f9d">get_gun_status</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">double</span> <a class="code" href="acquisition_8h.html#a58656dec3e4dd7f6435eb1023df0155d">get_move_angle</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">double</span> <a class="code" href="acquisition_8h.html#af5b4a5af0d21643e7a6a1f9a445f5c05">get_gun_angle</a>(<span class="keywordtype">char</span>* me); </div><div class="line"><span class="keywordtype">double</span> <a class="code" href="acquisition_8h.html#a9231bb101df2b08ac77de0a79dc1af60">get_radar_angle</a>(<span class="keywordtype">char</span>* me); </div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="acquisition_8h.html#ae68f209bd4d11f1b62e45f1bd13d39cb">get_scan_from_radar</a>(<span class="keywordtype">char</span>* me, <a class="code" href="structView__starship.html">View_starship</a>** S, <span class="keywordtype">int</span>* nb_starship, <a class="code" href="structView__missile.html">View_missile</a>** M, <span class="keywordtype">int</span>* nb_missile); </div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><p><code>me</code> is a C string (char*) which must point to the string equal to the name of your shared object. This technically requirement is due the fact that the acquisition module need to identify the caller but C is not an oriented object language (for which the caller <code>this</code> or <code>self</code> is easily accessible). Don't try to cheat, a call to these functions with another name than the name of your plugin can produce some casualties. As the variable <code>me</code> could be use in each call to an acquisition function, it is therefore advise to place your shared object name in a nice static variable that could be then used in each function of your plugin.</p>
<h2><a class="anchor" id="symbols"></a>
The required symbols</h2>
<p>A plugin MUST implement three functions to be loadable :</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="full__dummy_8c.html#a394d043ecfd56279829c6df77e7f3908">decision_frame</a>(<a class="code" href="structDecision__frame.html">Decision_frame</a>* d);</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="full__dummy_8c.html#abf4ff639971a66a7a1eb938231801982">initialize_my_AI</a>(<span class="keywordtype">void</span>);</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="full__dummy_8c.html#a43b17fdcb725b7885f6d39210cb1a34f">clean_my_AI</a>(<span class="keywordtype">void</span>);</div></div><!-- fragment --><p>The function <code>decision_frame</code> is the core of the plugin (and can evidently call a lot of another function of your plugin). Each frame during end frame resolution, this function will be called to determine what is the future behavior of your starship. The function must modify the structure in parameter but MUST respect some page of values.</p>
<p>A starship can change its gear (neutral, front and reverse). When the plugin want to change the speed, a starship must respect a frame neutral between changing from front to reverse. A starship can change each frame of direction but only of 0.05 radian each frame. Gun and radar can turn faster up to the amount of 0.15 radian per frame. A starship can use its gun only when this last one is reloaded. The launched missile has for direction the angle of the gun at the frame of fire.</p>
<h2><a class="anchor" id="plugin"></a>
Writing its own plugin</h2>
<p>A minimal plugin is illustrated by the full_dummy.so plugin example :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../includes/acquisition.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="full__dummy_8c.html#a394d043ecfd56279829c6df77e7f3908">decision_frame</a>(<a class="code" href="structDecision__frame.html">Decision_frame</a>* d){</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="full__dummy_8c.html#abf4ff639971a66a7a1eb938231801982">initialize_my_AI</a>(<span class="keywordtype">void</span>){</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="full__dummy_8c.html#a43b17fdcb725b7885f6d39210cb1a34f">clean_my_AI</a>(<span class="keywordtype">void</span>){</div><div class="line">}</div></div><!-- fragment --><p>The resulted starship will do nothing during a game. It will stay at its random starting position and wait for its explosion.</p>
<p>A such plugin whose source code live in a life <a class="el" href="full__dummy_8c.html" title="An example of artificial intelligence plugin completely dummy. ">full_dummy.c</a> can be compiled with the following two line of compilation executed in the main directory of the project :</p>
<div class="fragment"><div class="line">gcc -fPIC -c plugins/full_dummy.c -o plugins/full_dummy.o</div><div class="line">gcc -shared -o plugins/full_dummy.so plugins/full_dummy.o bin/acquisition.o</div></div><!-- fragment --><p>The compilation and its linking part required the object <code>bin/acquisition.o</code> which have been also compiled with the option -fPIC making the plugin completely position independent. Be aware that mixing static variables and position independent code can produce serious problem on some architecture. Anyway, the program have been largely tested.</p>
<h2><a class="anchor" id="radar"></a>
Use of the radar</h2>
<p>Advanced plugins analyse the space to get information and take the best solution of positionning and shoting. For that, the associated starship must use fully the radar. A relatively dummy plugin show you how to get information from the radar : <a class="el" href="rand__move__info_8c.html" title="An example of artificial intelligence plugin moving randomly and displaying information. ">rand_move_info.c</a></p>
<p>Most of acquisition functions return about yourself. The last function of acquisition prepares for you information that you radar can reach.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="acquisition_8h.html#ae68f209bd4d11f1b62e45f1bd13d39cb">get_scan_from_radar</a>(<span class="keywordtype">char</span>* me, <a class="code" href="structView__starship.html">View_starship</a>** S, <span class="keywordtype">int</span>* nb_starship, <a class="code" href="structView__missile.html">View_missile</a>** M, <span class="keywordtype">int</span>* nb_missile);</div></div><!-- fragment --><p>Don't worry about allocation, the acquisition module does it for you! You just have to give to this acquisition function two address of integer and two modifiable address of arrays : one of <code><a class="el" href="structView__starship.html" title="This structure gathers information scaned by the radar about other starships. ">View_starship</a></code> array (View_starship**) and another for an array of <code><a class="el" href="structView__missile.html" title="This structure gathers information scaned by the radar about missiles. ">View_missile</a></code> (View_missile**). Once executed, the variable <code>*S</code> will point to a proper array compose of <code>*nb_starship</code> element of type <code><a class="el" href="structView__starship.html" title="This structure gathers information scaned by the radar about other starships. ">View_starship</a></code> and <code>*M</code> will be the address of an array of <code><a class="el" href="structView__missile.html" title="This structure gathers information scaned by the radar about missiles. ">View_missile</a></code> containing <code>*nb_missile</code> element.</p>
<p>As this function will set same values you will call it several times during the same frame, a nice solution consist in placing information in static variables of your plugin. Your plugin is not optimized if you call this function more than a single time each frame.</p>
<h1><a class="anchor" id="game"></a>
Game details and rules</h1>
<p>Here is a recall of some rules for this game. Respect them if you don't want the shame falling on you and your descendants for several generations :</p>
<ul>
<li>A plugin must not reduced too largely the charge of the execution.</li>
<li>A plugin must not try to get information it doesn't deserve to get.</li>
<li>A starship should not destroy its allies.</li>
<li>A starship could try to save allies by intercepting missiles with its body but... That can be done so long and it can be very difficult to program.</li>
<li>Static variables are not very smart but wrapped in a shared object stay locally in your code (they will not loaded by the plugin loader...).</li>
<li>A nice plugin respect the values imposed during decision making.</li>
</ul>
<h1><a class="anchor" id="action"></a>
It is time to action</h1>
<p>Here is a natural way to develop your own starship.</p>
<ul>
<li>Step 1 : recall high school curse of trigonometry (sin, cos, tan, asin, acos, atan, ...)</li>
<li>Step 2 : recall high school curse of trigonometry (sin, cos, tan, asin, acos, atan, ...)</li>
<li>Step 3 : is identical to step 2</li>
<li>Step 4 : recall high school lesson about barycenter (useful for positioning...)</li>
<li>Step 5 : the law of classical physics are your friends</li>
<li>Step 6 : Program and win!</li>
</ul>
<p>Such an easy and light plan...</p>
<h1><a class="anchor" id="bugs"></a>
Known bugs and improvements suggestions</h1>
<p>Please report bug by sending a mail and the precise conditions which make the apparition of the bug at the address &lt; nicolas dot borie at u-pem dot fr &gt;. If you have suggestions of improvements, you are also invited to send them at the same address.</p>
<p>"Celui qui programme ses jeux s'amuse deux fois." @ Jacques Arsac</p>
<p>Have fun !!!!!!!!!!!!!!</p>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Nicolas Borie ( nicolas dot borie at u-pem dot fr ) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10 march 2014 </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 28 2020 22:51:03 for Starship Code Contest by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
